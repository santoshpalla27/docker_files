# Build stage
FROM node:22-alpine AS builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .

RUN npm run build  # Uncomment if needed

# Prune dev dependencies
RUN npm prune --production

# Production stage with distroless
FROM gcr.io/distroless/nodejs22-debian12

WORKDIR /app

# Copy from builder
COPY --from=builder --chown=nonroot:nonroot /app /app

EXPOSE 3000

USER nonroot

CMD ["index.js"]